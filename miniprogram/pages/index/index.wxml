<!--index.wxml-->
<view class="container">
  <!-- æ¶ˆæ¯åˆ—è¡¨ -->
  <scroll-view class="messages-container" scroll-y scroll-top="{{scrollTop}}" scroll-with-animation id="messages">
    <view class="message-list">
      <view wx:for="{{messages}}" wx:key="id" class="message-item {{item.type}}">
        <view class="message-content">
          <view class="message-text">{{item.content}}</view>
          <view class="message-time">{{item.timestamp}}</view>
        </view>
        <view wx:if="{{item.type === 'assistant'}}" class="message-actions">
          <button class="play-btn" bindtap="playTTS" data-text="{{item.content}}" data-id="{{item.id}}" disabled="{{isPlayingTTS || item.type !== 'assistant'}}">
            <text class="icon">ğŸ”Š</text>
          </button>
        </view>
      </view>
      
      <!-- æµå¼æ˜¾ç¤º -->
      <view wx:if="{{isStreaming && streamingText}}" class="message-item assistant">
        <view class="message-content">
          <view class="message-text">{{streamingText}}<text class="cursor">|</text></view>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- çŠ¶æ€æŒ‡ç¤ºå™¨ -->
  <view wx:if="{{isRecording || isLoading || isStreaming}}" class="status-indicator">
    <text wx:if="{{isRecording}}">ğŸ¤ å½•éŸ³ä¸­... {{recordingDuration}}s</text>
    <text wx:elif="{{isLoading}}">ğŸ¤– AIæ€è€ƒä¸­...</text>
    <text wx:elif="{{isStreaming}}">ğŸ“ AIå›å¤ä¸­...</text>
  </view>

  <!-- è¾“å…¥æ  -->
  <view class="input-bar">
    <view class="input-container">
      <input 
        class="input" 
        placeholder="è¾“å…¥æ¶ˆæ¯..." 
        value="{{inputText}}"
        bindinput="onInputChange"
        bindconfirm="sendMessage"
        confirm-type="send"
        disabled="{{isLoading || isStreaming}}"
      />
      <view class="actions">
        <button 
          class="record-btn {{isRecording ? 'recording' : ''}}" 
          bindtouchstart="startRecord" 
          bindtouchend="stopRecord"
          bindtouchcancel="stopRecord"
          disabled="{{isLoading || isStreaming}}"
        >
          <text class="icon">ğŸ¤</text>
        </button>
        <button 
          class="send-btn" 
          bindtap="sendMessage"
          disabled="{{!inputText || isLoading || isStreaming}}"
        >
          å‘é€
        </button>
      </view>
    </view>
  </view>
</view>

