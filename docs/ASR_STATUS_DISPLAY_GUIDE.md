# ASR状态显示功能使用指南

## 🎯 功能概述

NEXUS应用现在支持语音识别过程中的实时状态显示，用户在进行语音识别时可以看到详细的处理进度和状态信息。

## ✨ 新增功能

### 1. 实时状态显示
- **"正在识别中..."** 提示
- **进度百分比** 显示 (0-100%)
- **处理时间** 实时更新
- **进度条** 可视化显示

### 2. 状态信息
- 处理阶段：10% → 30% → 50% → 70% → 90% → 100%
- 实时处理时间显示
- 请求ID跟踪
- 服务健康状态

## 🔧 技术实现

### 后端实现
- **状态跟踪**: `asr_processing_status` 全局状态管理
- **API端点**: `GET /api/asr/status` 查询实时状态
- **进度更新**: 在语音识别过程中实时更新进度
- **监控集成**: 与现有监控系统完全集成

### Android实现
- **ASRService增强**: 添加状态监控和回调机制
- **ASRStatus数据类**: 包含所有状态信息
- **UI更新**: StatusIndicator组件显示详细状态
- **实时轮询**: 每秒查询后端状态

## 📱 用户界面

### 状态显示组件
```
🎯 语音识别中... 75%
[████████████████████░░░░] 75%
处理时间: 2.3s
```

### 状态阶段
1. **录音阶段**: "🎤 正在录音..."
2. **识别阶段**: "🎯 语音识别中... X%"
3. **完成阶段**: 显示识别结果

## 🚀 使用方法

### 1. 语音识别流程
1. 点击麦克风按钮开始录音
2. 看到"正在录音..."提示
3. 松开按钮停止录音
4. 自动显示"正在识别中..."和进度
5. 识别完成后显示结果

### 2. 状态信息解读
- **进度百分比**: 显示当前处理阶段
- **处理时间**: 从开始识别到当前的时间
- **进度条**: 直观显示处理进度
- **健康状态**: 显示ASR服务状态

## 🔍 状态监控

### 实时状态查询
```bash
curl http://192.168.64.85:5000/api/asr/status
```

### 状态数据结构
```json
{
  "status": "success",
  "asr_health": "healthy",
  "processing": {
    "is_processing": true,
    "current_request_id": "uuid-string",
    "progress": 75,
    "processing_time": 2.3,
    "start_time": 1640995200.0
  }
}
```

## 📊 进度阶段说明

| 阶段 | 进度 | 说明 |
|------|------|------|
| 请求接收 | 10% | 开始处理语音识别请求 |
| 文件保存 | 30% | 音频文件保存到临时目录 |
| 文件准备 | 50% | 文件格式验证和准备 |
| 开始识别 | 70% | 调用Dolphin ASR进行识别 |
| 识别完成 | 90% | 识别处理完成，准备返回 |
| 处理完成 | 100% | 整个流程完成 |

## 🎨 UI设计特点

### 视觉反馈
- **颜色编码**: 橙色表示识别中状态
- **动画效果**: 进度条平滑动画
- **实时更新**: 每秒更新状态信息
- **清晰提示**: 明确的状态文字说明

### 响应式设计
- 适配不同屏幕尺寸
- 支持深色/浅色主题
- 字体大小自适应
- 触摸友好的界面

## 🔧 配置参数

### 轮询设置
- **轮询间隔**: 1秒
- **超时时间**: 5秒
- **重试次数**: 3次

### 显示设置
- **进度精度**: 1%
- **时间精度**: 0.1秒
- **更新频率**: 实时

## 🐛 故障排除

### 常见问题
1. **状态不更新**: 检查网络连接和后端服务
2. **进度卡住**: 检查ASR服务是否正常
3. **显示异常**: 检查Android应用版本

### 调试方法
1. 查看Android日志: `adb logcat | grep ASRService`
2. 检查后端状态: 访问 `/api/asr/status`
3. 监控网络请求: 使用抓包工具

## 📈 性能优化

### 后端优化
- 状态更新异步处理
- 内存使用优化
- 并发请求处理

### Android优化
- 协程异步处理
- 状态缓存机制
- UI更新优化

## 🔮 未来扩展

### 计划功能
- 识别质量评估
- 多语言支持
- 离线模式
- 语音命令识别

### 技术改进
- WebSocket实时通信
- 更精确的进度计算
- 智能重试机制
- 性能监控面板

---

通过这个功能，用户在进行语音识别时可以获得更好的体验，清楚地了解处理进度和状态，大大提升了应用的可用性和用户满意度。
